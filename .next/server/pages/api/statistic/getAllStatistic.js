"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/statistic/getAllStatistic";
exports.ids = ["pages/api/statistic/getAllStatistic"];
exports.modules = {

/***/ "./lib/prisma.js":
/*!***********************!*\
  !*** ./lib/prisma.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nlet prisma;\n\nif (false) {} else {\n  if (!global.prisma) {\n    global.prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n  }\n\n  prisma = global.prisma;\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9saWIvcHJpc21hLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBRUEsSUFBSUMsTUFBSjs7QUFFQSxJQUFJLE9BQXVDLEVBQTNDLE1BRU87QUFDTCxNQUFJLENBQUNDLE1BQU0sQ0FBQ0QsTUFBWixFQUFvQjtBQUNsQkMsSUFBQUEsTUFBTSxDQUFDRCxNQUFQLEdBQWdCLElBQUlELHdEQUFKLEVBQWhCO0FBQ0Q7O0FBQ0RDLEVBQUFBLE1BQU0sR0FBR0MsTUFBTSxDQUFDRCxNQUFoQjtBQUNEOztBQUNELGlFQUFlQSxNQUFmIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktbmV4dC8uL2xpYi9wcmlzbWEuanM/YzU2NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxubGV0IHByaXNtYVxuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KClcbn0gZWxzZSB7XG4gIGlmICghZ2xvYmFsLnByaXNtYSkge1xuICAgIGdsb2JhbC5wcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KClcbiAgfVxuICBwcmlzbWEgPSBnbG9iYWwucHJpc21hXG59XG5leHBvcnQgZGVmYXVsdCBwcmlzbWEiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2xvYmFsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./lib/prisma.js\n");

/***/ }),

/***/ "./pages/api/statistic/getAllStatistic.ts":
/*!************************************************!*\
  !*** ./pages/api/statistic/getAllStatistic.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _utils_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils.server */ \"./utils.server.ts\");\n/* harmony import */ var _utils_getProfitLists__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../utils/getProfitLists */ \"./utils/getProfitLists.ts\");\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! dayjs */ \"dayjs\");\n/* harmony import */ var dayjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/prisma */ \"./lib/prisma.js\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nconst getDayArray = (startDate, endDate) => {\n  const startDateMs = dayjs__WEBPACK_IMPORTED_MODULE_2___default()(startDate).valueOf();\n  const endDateMs = dayjs__WEBPACK_IMPORTED_MODULE_2___default()(endDate).valueOf();\n  const days = (endDateMs - startDateMs) / 60 / 60 / 1000 / 24 + 1;\n  const daysArray = []; // const LocalSkuMidProfitList = ctx.model.Fulin.LocalSkuMidProfitList;\n\n  const x_axis = [];\n\n  for (let i = 0; i < days; i++) {\n    if (i % 7 === 0) {\n      const pStartDateMs = startDateMs + i * 60 * 60 * 24 * 1000;\n      const pEndDateMs = pStartDateMs + 6 * 24 * 60 * 60 * 1000 > endDateMs ? endDateMs : pStartDateMs + 6 * 24 * 60 * 60 * 1000;\n      x_axis.push(dayjs__WEBPACK_IMPORTED_MODULE_2___default()(startDateMs + i * 60 * 60 * 24 * 1000).format('YYYY-MM-DD'));\n      daysArray.push({\n        date_str: dayjs__WEBPACK_IMPORTED_MODULE_2___default()(startDateMs + i * 60 * 60 * 24 * 1000).format('YYYY-MM-DD'),\n        // startDateMs: pStartDateMs,\n        // endDateMs: pEndDateMs,\n        start_date_str: dayjs__WEBPACK_IMPORTED_MODULE_2___default()(startDateMs + i * 60 * 60 * 24 * 1000).format('YYYY-MM-DD'),\n        end_date_str: dayjs__WEBPACK_IMPORTED_MODULE_2___default()(pEndDateMs).format('YYYY-MM-DD')\n      });\n    }\n  }\n\n  return {\n    daysArray,\n    x_axis\n  };\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_utils_server__WEBPACK_IMPORTED_MODULE_0__.default)().post(async (req, res) => {\n  console.log('all');\n  const {\n    cid,\n    mid,\n    startDate,\n    endDate\n  } = req.body;\n  const {\n    daysArray,\n    x_axis\n  } = getDayArray(startDate, endDate);\n  let categories = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.default.categories.findMany();\n  let rateList = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.default.rate_lists.findMany();\n  const rateEnum = {};\n  rateList.map(item => {\n    rateEnum[item.code_date] = item;\n  });\n  const promiseArray = [];\n  categories.map(item => {\n    daysArray.map(element => {\n      promiseArray.push(_objectSpread(_objectSpread({}, element), item));\n      return element;\n    });\n    item.weekAds = daysArray;\n    return item;\n  });\n  const skuWeekData = [];\n  let data = [];\n  const promiseAllArray = [];\n  promiseArray.map(item => {\n    const cid = item.cid;\n    const startDate = item.start_date_str;\n    const endDate = item.end_date_str;\n    promiseAllArray.push((0,_utils_getProfitLists__WEBPACK_IMPORTED_MODULE_1__.default)({\n      cid,\n      startDate,\n      endDate\n    }));\n  });\n  await Promise.all(promiseAllArray).then(res => {\n    data = res;\n    res.map((arr, arrIndex) => {\n      const statistic = {\n        cost: 0,\n        category_text: '',\n        cid: '',\n        sales_amount: 0,\n        date_str: promiseArray[arrIndex].date_str,\n        ratio: 1,\n        gross_profit: 0\n      };\n      arr.map(element => {\n        const code_date = element.code + '_' + dayjs__WEBPACK_IMPORTED_MODULE_2___default()(element.date_str).format('YYYY-MM');\n        const us_rate = Number(rateEnum['USD_' + dayjs__WEBPACK_IMPORTED_MODULE_2___default()(element.date_str).format('YYYY-MM')].rate || 1);\n        const rate = Number(rateEnum[code_date].rate || 1);\n        const ratio = rate / us_rate || 1;\n        const ad_cost = Number(element.sp_cost || 0) + Number(element.sb_cost || 0) + Number(element.sbv_cost || 0) + Number(element.sd_cost || 0);\n        const gross_profit = Number(element.total_amount || 0) + Number(element.refund_amount || 0) + Number(element.channel_fee || 0) + Number(element.commission_amount || 0) + Number(element.promotion_amount || 0) + Number(element.total_cg_price || 0) + Number(element.total_cg_transport_costs || 0) + Number(element.other_order_fee || 0) - ad_cost; // console.log(element.total_amount, element.refund_amount, element.channel_fee, element.commission_amount, element.promotion_amount, element.total_cg_price, element.total_cg_transport_costs, element.other_order_fee);\n\n        statistic.gross_profit += Number(gross_profit) * ratio;\n        statistic.cost += ad_cost * ratio;\n        statistic.sales_amount += Number(element.total_amount) * ratio;\n        statistic.category_text = element.category_text;\n        statistic.cid = element.cid;\n        statistic.ratio = ratio;\n      });\n      skuWeekData.push(statistic);\n    });\n  });\n  let cost_sum = 0;\n  let sales_amount_sum = 0;\n  let gross_profit_sum = 0;\n  categories.map(item => {\n    const weekAds = [];\n    item.total_sales_amount = 0;\n    item.total_cost = 0;\n    item.total_gross_profit = 0;\n    item.weekAds.map(element => {\n      const data = skuWeekData.filter(weekData => {\n        return weekData.date_str === element.date_str && item.cid === weekData.cid;\n      })[0] || {};\n      element = _objectSpread(_objectSpread({}, element), data);\n      weekAds.push(element);\n      item.total_sales_amount += Number(data.sales_amount);\n      item.total_cost += Number(data.cost);\n      item.total_gross_profit += Number(data.gross_profit);\n      item.total_gross_profit_rate = item.total_gross_profit / item.total_sales_amount;\n      return element;\n    });\n    item.weekAds = weekAds;\n    gross_profit_sum += item.total_gross_profit;\n    cost_sum += item.total_cost;\n    sales_amount_sum += item.total_sales_amount;\n    return item;\n  });\n  res.send({\n    response: {\n      gross_profit_sum,\n      cost_sum,\n      sales_amount_sum,\n      categories,\n      x_axis\n    }\n  });\n  res.end();\n}));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWdlcy9hcGkvc3RhdGlzdGljL2dldEFsbFN0YXRpc3RpYy50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUVBO0FBQ0E7QUFFQTs7QUFHQSxNQUFNSSxXQUFXLEdBQUcsQ0FBQ0MsU0FBRCxFQUFZQyxPQUFaLEtBQXdCO0FBQzFDLFFBQU1DLFdBQVcsR0FBR0wsNENBQUssQ0FBQ0csU0FBRCxDQUFMLENBQWlCRyxPQUFqQixFQUFwQjtBQUNBLFFBQU1DLFNBQVMsR0FBR1AsNENBQUssQ0FBQ0ksT0FBRCxDQUFMLENBQWVFLE9BQWYsRUFBbEI7QUFDQSxRQUFNRSxJQUFJLEdBQUcsQ0FBQ0QsU0FBUyxHQUFHRixXQUFiLElBQTRCLEVBQTVCLEdBQWlDLEVBQWpDLEdBQXNDLElBQXRDLEdBQTZDLEVBQTdDLEdBQWtELENBQS9EO0FBQ0EsUUFBTUksU0FBUyxHQUFHLEVBQWxCLENBSjBDLENBSzFDOztBQUNBLFFBQU1DLE1BQU0sR0FBRyxFQUFmOztBQUNBLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsSUFBcEIsRUFBMEJHLENBQUMsRUFBM0IsRUFBK0I7QUFDN0IsUUFBSUEsQ0FBQyxHQUFHLENBQUosS0FBVSxDQUFkLEVBQWlCO0FBQ2YsWUFBTUMsWUFBWSxHQUFHUCxXQUFXLEdBQUdNLENBQUMsR0FBRyxFQUFKLEdBQVMsRUFBVCxHQUFjLEVBQWQsR0FBbUIsSUFBdEQ7QUFDQSxZQUFNRSxVQUFVLEdBQUlELFlBQVksR0FBRyxJQUFJLEVBQUosR0FBUyxFQUFULEdBQWMsRUFBZCxHQUFtQixJQUFuQyxHQUEyQ0wsU0FBM0MsR0FBdURBLFNBQXZELEdBQW9FSyxZQUFZLEdBQUcsSUFBSSxFQUFKLEdBQVMsRUFBVCxHQUFjLEVBQWQsR0FBbUIsSUFBekg7QUFDQUYsTUFBQUEsTUFBTSxDQUFDSSxJQUFQLENBQVlkLDRDQUFLLENBQUNLLFdBQVcsR0FBR00sQ0FBQyxHQUFHLEVBQUosR0FBUyxFQUFU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ZixJQUFJLENBQUNZLFlBQU4sQ0FBakM7QUFDQWxCLE1BQUFBLElBQUksQ0FBQzRDLHVCQUFMLEdBQStCNUMsSUFBSSxDQUFDeUMsa0JBQUwsR0FBMEJ6QyxJQUFJLENBQUN1QyxrQkFBOUQ7QUFFQSxhQUFPcEMsT0FBUDtBQUNELEtBWkQ7QUFjQUgsSUFBQUEsSUFBSSxDQUFDSSxPQUFMLEdBQWVBLE9BQWY7QUFDQWtDLElBQUFBLGdCQUFnQixJQUFJdEMsSUFBSSxDQUFDeUMsa0JBQXpCO0FBQ0FMLElBQUFBLFFBQVEsSUFBSXBDLElBQUksQ0FBQ3dDLFVBQWpCO0FBQ0FILElBQUFBLGdCQUFnQixJQUFJckMsSUFBSSxDQUFDdUMsa0JBQXpCO0FBQ0EsV0FBT3ZDLElBQVA7QUFDRCxHQXhCRDtBQTBCRlosRUFBQUEsR0FBRyxDQUFDeUQsSUFBSixDQUFTO0FBQ1BDLElBQUFBLFFBQVEsRUFBQztBQUNQUixNQUFBQSxnQkFETztBQUVQRixNQUFBQSxRQUZPO0FBR1BDLE1BQUFBLGdCQUhPO0FBSVAzQyxNQUFBQSxVQUpPO0FBS1BqQixNQUFBQTtBQUxPO0FBREYsR0FBVDtBQVNBVyxFQUFBQSxHQUFHLENBQUMyRCxHQUFKO0FBRUQsQ0FwSGMsQ0FBZiIsInNvdXJjZXMiOlsid2VicGFjazovL215LW5leHQvLi9wYWdlcy9hcGkvc3RhdGlzdGljL2dldEFsbFN0YXRpc3RpYy50cz82ZDgyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhcGlIYW5kbGVyIGZyb20gXCIuLi8uLi8uLi91dGlscy5zZXJ2ZXJcIjtcbmltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xuaW1wb3J0IGdldFByb2ZpdExpc3RzIGZyb20gXCIuLi8uLi8uLi91dGlscy9nZXRQcm9maXRMaXN0c1wiO1xuaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJztcbmltcG9ydCBuYyBmcm9tICduZXh0LWNvbm5lY3QnXG5pbXBvcnQgcHJpc21hIGZyb20gJy4uLy4uLy4uL2xpYi9wcmlzbWEnXG5cblxuY29uc3QgZ2V0RGF5QXJyYXkgPSAoc3RhcnREYXRlLCBlbmREYXRlKSA9PiB7XG4gIGNvbnN0IHN0YXJ0RGF0ZU1zID0gZGF5anMoc3RhcnREYXRlKS52YWx1ZU9mKCk7XG4gIGNvbnN0IGVuZERhdGVNcyA9IGRheWpzKGVuZERhdGUpLnZhbHVlT2YoKTtcbiAgY29uc3QgZGF5cyA9IChlbmREYXRlTXMgLSBzdGFydERhdGVNcykgLyA2MCAvIDYwIC8gMTAwMCAvIDI0ICsgMTtcbiAgY29uc3QgZGF5c0FycmF5ID0gW107XG4gIC8vIGNvbnN0IExvY2FsU2t1TWlkUHJvZml0TGlzdCA9IGN0eC5tb2RlbC5GdWxpbi5Mb2NhbFNrdU1pZFByb2ZpdExpc3Q7XG4gIGNvbnN0IHhfYXhpcyA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRheXM7IGkrKykge1xuICAgIGlmIChpICUgNyA9PT0gMCkge1xuICAgICAgY29uc3QgcFN0YXJ0RGF0ZU1zID0gc3RhcnREYXRlTXMgKyBpICogNjAgKiA2MCAqIDI0ICogMTAwMDtcbiAgICAgIGNvbnN0IHBFbmREYXRlTXMgPSAocFN0YXJ0RGF0ZU1zICsgNiAqIDI0ICogNjAgKiA2MCAqIDEwMDApID4gZW5kRGF0ZU1zID8gZW5kRGF0ZU1zIDogKHBTdGFydERhdGVNcyArIDYgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIHhfYXhpcy5wdXNoKGRheWpzKHN0YXJ0RGF0ZU1zICsgaSAqIDYwICogNjAgKiAyNCAqIDEwMDApLmZvcm1hdCgnWVlZWS1NTS1ERCcpKTtcbiAgICAgIGRheXNBcnJheS5wdXNoKHtcbiAgICAgICAgZGF0ZV9zdHI6IGRheWpzKHN0YXJ0RGF0ZU1zICsgaSAqIDYwICogNjAgKiAyNCAqIDEwMDApLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAvLyBzdGFydERhdGVNczogcFN0YXJ0RGF0ZU1zLFxuICAgICAgICAvLyBlbmREYXRlTXM6IHBFbmREYXRlTXMsXG4gICAgICAgIHN0YXJ0X2RhdGVfc3RyOiBkYXlqcyhzdGFydERhdGVNcyArIGkgKiA2MCAqIDYwICogMjQgKiAxMDAwKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgZW5kX2RhdGVfc3RyOiBkYXlqcyhwRW5kRGF0ZU1zKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcblxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgZGF5c0FycmF5LFxuICAgIHhfYXhpcyxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXBpSGFuZGxlcigpLnBvc3QoYXN5bmMocmVxLHJlcykgPT4ge1xuICBjb25zb2xlLmxvZygnYWxsJylcbiAgY29uc3QgeyBjaWQsbWlkLHN0YXJ0RGF0ZSxlbmREYXRlIH0gPSByZXEuYm9keTtcblxuICBjb25zdCB7ZGF5c0FycmF5LHhfYXhpc30gPSBnZXREYXlBcnJheShzdGFydERhdGUsIGVuZERhdGUpXG4gIFxuICBsZXQgY2F0ZWdvcmllcyA9IGF3YWl0IHByaXNtYS5jYXRlZ29yaWVzLmZpbmRNYW55KCk7XG4gIGxldCByYXRlTGlzdCA9IGF3YWl0IHByaXNtYS5yYXRlX2xpc3RzLmZpbmRNYW55KCk7XG5cbiAgY29uc3QgcmF0ZUVudW0gPSB7fTtcbiAgcmF0ZUxpc3QubWFwKGl0ZW0gPT4ge1xuICAgIHJhdGVFbnVtW2l0ZW0uY29kZV9kYXRlXSA9IGl0ZW07XG4gIH0pO1xuXG4gIGNvbnN0IHByb21pc2VBcnJheSA9IFtdO1xuICBjYXRlZ29yaWVzLm1hcChpdGVtID0+IHtcbiAgICBkYXlzQXJyYXkubWFwKGVsZW1lbnQgPT4ge1xuICAgICAgcHJvbWlzZUFycmF5LnB1c2goe1xuICAgICAgICAuLi5lbGVtZW50LFxuICAgICAgICAuLi5pdGVtLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9KTtcbiAgICBpdGVtLndlZWtBZHMgPSBkYXlzQXJyYXk7XG4gICAgcmV0dXJuIGl0ZW07XG4gIH0pO1xuICBjb25zdCBza3VXZWVrRGF0YSA9IFtdO1xuICBsZXQgZGF0YSA9IFtdO1xuXG4gIGNvbnN0IHByb21pc2VBbGxBcnJheSA9IFtdXG4gIHByb21pc2VBcnJheS5tYXAoaXRlbSA9PiB7XG4gICAgY29uc3QgY2lkID0gaXRlbS5jaWQ7XG4gICAgY29uc3Qgc3RhcnREYXRlID0gaXRlbS5zdGFydF9kYXRlX3N0cjtcbiAgICBjb25zdCBlbmREYXRlID0gIGl0ZW0uZW5kX2RhdGVfc3RyXG5cbiAgICBwcm9taXNlQWxsQXJyYXkucHVzaChnZXRQcm9maXRMaXN0cyh7XG4gICAgICBjaWQsXG4gICAgICBzdGFydERhdGUsXG4gICAgICBlbmREYXRlXG4gICAgfSkpIDtcbiAgfSlcbiAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZUFsbEFycmF5KS50aGVuKHJlcyA9PiB7XG4gICAgICBkYXRhID0gcmVzO1xuICAgICAgcmVzLm1hcCgoYXJyLCBhcnJJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBzdGF0aXN0aWMgPSB7XG4gICAgICAgICAgY29zdDogMCxcbiAgICAgICAgICBjYXRlZ29yeV90ZXh0OiAnJyxcbiAgICAgICAgICBjaWQ6ICcnLFxuICAgICAgICAgIHNhbGVzX2Ftb3VudDogMCxcbiAgICAgICAgICBkYXRlX3N0cjogcHJvbWlzZUFycmF5W2FyckluZGV4XS5kYXRlX3N0cixcbiAgICAgICAgICByYXRpbzogMSxcbiAgICAgICAgICBncm9zc19wcm9maXQ6IDAsXG4gICAgICAgIH07XG4gICAgICAgIGFyci5tYXAoZWxlbWVudCA9PiB7XG5cbiAgICAgICAgICBjb25zdCBjb2RlX2RhdGUgPSBlbGVtZW50LmNvZGUgKyAnXycgKyBkYXlqcyhlbGVtZW50LmRhdGVfc3RyKS5mb3JtYXQoJ1lZWVktTU0nKTtcbiAgICAgICAgICBjb25zdCB1c19yYXRlID0gTnVtYmVyKHJhdGVFbnVtWydVU0RfJyArIGRheWpzKGVsZW1lbnQuZGF0ZV9zdHIpLmZvcm1hdCgnWVlZWS1NTScpXS5yYXRlIHx8IDEpO1xuICAgICAgICAgIGNvbnN0IHJhdGUgPSBOdW1iZXIocmF0ZUVudW1bY29kZV9kYXRlXS5yYXRlIHx8IDEpO1xuICAgICAgICAgIGNvbnN0IHJhdGlvID0gKHJhdGUgLyB1c19yYXRlKSB8fCAxO1xuICAgICAgICAgIGNvbnN0IGFkX2Nvc3QgPSBOdW1iZXIoZWxlbWVudC5zcF9jb3N0IHx8IDApICsgTnVtYmVyKGVsZW1lbnQuc2JfY29zdCB8fCAwKSArIE51bWJlcihlbGVtZW50LnNidl9jb3N0IHx8IDApICsgTnVtYmVyKGVsZW1lbnQuc2RfY29zdCB8fCAwKTtcbiAgICAgICAgICBjb25zdCBncm9zc19wcm9maXQgPSBOdW1iZXIoZWxlbWVudC50b3RhbF9hbW91bnQgfHwgMCkgKyBOdW1iZXIoZWxlbWVudC5yZWZ1bmRfYW1vdW50IHx8IDApICsgTnVtYmVyKGVsZW1lbnQuY2hhbm5lbF9mZWUgfHwgMCkgKyBOdW1iZXIoZWxlbWVudC5jb21taXNzaW9uX2Ftb3VudCB8fCAwKSArIE51bWJlcihlbGVtZW50LnByb21vdGlvbl9hbW91bnQgfHwgMCkgKyBOdW1iZXIoZWxlbWVudC50b3RhbF9jZ19wcmljZSB8fCAwKSArIE51bWJlcihlbGVtZW50LnRvdGFsX2NnX3RyYW5zcG9ydF9jb3N0cyB8fCAwKSArIE51bWJlcihlbGVtZW50Lm90aGVyX29yZGVyX2ZlZSB8fCAwKSAtIGFkX2Nvc3Q7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coZWxlbWVudC50b3RhbF9hbW91bnQsIGVsZW1lbnQucmVmdW5kX2Ftb3VudCwgZWxlbWVudC5jaGFubmVsX2ZlZSwgZWxlbWVudC5jb21taXNzaW9uX2Ftb3VudCwgZWxlbWVudC5wcm9tb3Rpb25fYW1vdW50LCBlbGVtZW50LnRvdGFsX2NnX3ByaWNlLCBlbGVtZW50LnRvdGFsX2NnX3RyYW5zcG9ydF9jb3N0cywgZWxlbWVudC5vdGhlcl9vcmRlcl9mZWUpO1xuICAgICAgICAgIHN0YXRpc3RpYy5ncm9zc19wcm9maXQgKz0gTnVtYmVyKGdyb3NzX3Byb2ZpdCkgKiByYXRpbztcbiAgICAgICAgICBzdGF0aXN0aWMuY29zdCArPSBhZF9jb3N0ICogcmF0aW87XG4gICAgICAgICAgc3RhdGlzdGljLnNhbGVzX2Ftb3VudCArPSBOdW1iZXIoZWxlbWVudC50b3RhbF9hbW91bnQpICogcmF0aW87XG4gICAgICAgICAgc3RhdGlzdGljLmNhdGVnb3J5X3RleHQgPSBlbGVtZW50LmNhdGVnb3J5X3RleHQ7XG4gICAgICAgICAgc3RhdGlzdGljLmNpZCA9IGVsZW1lbnQuY2lkO1xuICAgICAgICAgIHN0YXRpc3RpYy5yYXRpbyA9IHJhdGlvO1xuXG4gICAgICAgIH0pO1xuICAgICAgICBza3VXZWVrRGF0YS5wdXNoKHN0YXRpc3RpYyk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuXG4gICAgbGV0IGNvc3Rfc3VtID0gMDtcbiAgICBsZXQgc2FsZXNfYW1vdW50X3N1bSA9IDA7XG4gICAgbGV0IGdyb3NzX3Byb2ZpdF9zdW0gPSAwO1xuXG4gICAgY2F0ZWdvcmllcy5tYXAoaXRlbSA9PiB7XG4gICAgICBjb25zdCB3ZWVrQWRzID0gW107XG4gICAgICBpdGVtLnRvdGFsX3NhbGVzX2Ftb3VudCA9IDA7XG4gICAgICBpdGVtLnRvdGFsX2Nvc3QgPSAwO1xuICAgICAgaXRlbS50b3RhbF9ncm9zc19wcm9maXQgPSAwO1xuICAgICAgaXRlbS53ZWVrQWRzLm1hcChlbGVtZW50ID0+IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHNrdVdlZWtEYXRhLmZpbHRlcih3ZWVrRGF0YSA9PiB7XG4gICAgICAgICAgcmV0dXJuICh3ZWVrRGF0YS5kYXRlX3N0ciA9PT0gZWxlbWVudC5kYXRlX3N0ciAmJiBpdGVtLmNpZCA9PT0gd2Vla0RhdGEuY2lkKTtcbiAgICAgICAgfSlbMF0gfHwge307XG4gICAgICAgIGVsZW1lbnQgPSB7IC4uLmVsZW1lbnQsIC4uLmRhdGEgfTtcbiAgICAgICAgd2Vla0Fkcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICBpdGVtLnRvdGFsX3NhbGVzX2Ftb3VudCArPSBOdW1iZXIoZGF0YS5zYWxlc19hbW91bnQpO1xuICAgICAgICBpdGVtLnRvdGFsX2Nvc3QgKz0gTnVtYmVyKGRhdGEuY29zdCk7XG4gICAgICAgIGl0ZW0udG90YWxfZ3Jvc3NfcHJvZml0ICs9IE51bWJlcihkYXRhLmdyb3NzX3Byb2ZpdCk7XG4gICAgICAgIGl0ZW0udG90YWxfZ3Jvc3NfcHJvZml0X3JhdGUgPSBpdGVtLnRvdGFsX2dyb3NzX3Byb2ZpdCAvIGl0ZW0udG90YWxfc2FsZXNfYW1vdW50O1xuXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgfSk7XG5cbiAgICAgIGl0ZW0ud2Vla0FkcyA9IHdlZWtBZHM7XG4gICAgICBncm9zc19wcm9maXRfc3VtICs9IGl0ZW0udG90YWxfZ3Jvc3NfcHJvZml0O1xuICAgICAgY29zdF9zdW0gKz0gaXRlbS50b3RhbF9jb3N0O1xuICAgICAgc2FsZXNfYW1vdW50X3N1bSArPSBpdGVtLnRvdGFsX3NhbGVzX2Ftb3VudDtcbiAgICAgIHJldHVybiBpdGVtO1xuICAgIH0pO1xuXG4gIHJlcy5zZW5kKHtcbiAgICByZXNwb25zZTp7XG4gICAgICBncm9zc19wcm9maXRfc3VtLFxuICAgICAgY29zdF9zdW0sXG4gICAgICBzYWxlc19hbW91bnRfc3VtLFxuICAgICAgY2F0ZWdvcmllcyxcbiAgICAgIHhfYXhpcyxcbiAgICB9XG4gIH0pXG4gIHJlcy5lbmQoKVxuXG59KTsiXSwibmFtZXMiOlsiYXBpSGFuZGxlciIsImdldFByb2ZpdExpc3RzIiwiZGF5anMiLCJwcmlzbWEiLCJnZXREYXlBcnJheSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJzdGFydERhdGVNcyIsInZhbHVlT2YiLCJlbmREYXRlTXMiLCJkYXlzIiwiZGF5c0FycmF5IiwieF9heGlzIiwiaSIsInBTdGFydERhdGVNcyIsInBFbmREYXRlTXMiLCJwdXNoIiwiZm9ybWF0IiwiZGF0ZV9zdHIiLCJzdGFydF9kYXRlX3N0ciIsImVuZF9kYXRlX3N0ciIsInBvc3QiLCJyZXEiLCJyZXMiLCJjb25zb2xlIiwibG9nIiwiY2lkIiwibWlkIiwiYm9keSIsImNhdGVnb3JpZXMiLCJmaW5kTWFueSIsInJhdGVMaXN0IiwicmF0ZV9saXN0cyIsInJhdGVFbnVtIiwibWFwIiwiaXRlbSIsImNvZGVfZGF0ZSIsInByb21pc2VBcnJheSIsImVsZW1lbnQiLCJ3ZWVrQWRzIiwic2t1V2Vla0RhdGEiLCJkYXRhIiwicHJvbWlzZUFsbEFycmF5IiwiUHJvbWlzZSIsImFsbCIsInRoZW4iLCJhcnIiLCJhcnJJbmRleCIsInN0YXRpc3RpYyIsImNvc3QiLCJjYXRlZ29yeV90ZXh0Iiwic2FsZXNfYW1vdW50IiwicmF0aW8iLCJncm9zc19wcm9maXQiLCJjb2RlIiwidXNfcmF0ZSIsIk51bWJlciIsInJhdGUiLCJhZF9jb3N0Iiwic3BfY29zdCIsInNiX2Nvc3QiLCJzYnZfY29zdCIsInNkX2Nvc3QiLCJ0b3RhbF9hbW91bnQiLCJyZWZ1bmRfYW1vdW50IiwiY2hhbm5lbF9mZWUiLCJjb21taXNzaW9uX2Ftb3VudCIsInByb21vdGlvbl9hbW91bnQiLCJ0b3RhbF9jZ19wcmljZSIsInRvdGFsX2NnX3RyYW5zcG9ydF9jb3N0cyIsIm90aGVyX29yZGVyX2ZlZSIsImNvc3Rfc3VtIiwic2FsZXNfYW1vdW50X3N1bSIsImdyb3NzX3Byb2ZpdF9zdW0iLCJ0b3RhbF9zYWxlc19hbW91bnQiLCJ0b3RhbF9jb3N0IiwidG90YWxfZ3Jvc3NfcHJvZml0IiwiZmlsdGVyIiwid2Vla0RhdGEiLCJ0b3RhbF9ncm9zc19wcm9maXRfcmF0ZSIsInNlbmQiLCJyZXNwb25zZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./pages/api/statistic/getAllStatistic.ts\n");

/***/ }),

/***/ "./utils.server.ts":
/*!*************************!*\
  !*** ./utils.server.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var next_connect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-connect */ \"next-connect\");\n/* harmony import */ var next_connect__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_connect__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _hapi_boom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @hapi/boom */ \"@hapi/boom\");\n/* harmony import */ var _hapi_boom__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_hapi_boom__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nconst apiHandler = () => next_connect__WEBPACK_IMPORTED_MODULE_0___default()({\n  onError(err, req, res) {\n    if (_hapi_boom__WEBPACK_IMPORTED_MODULE_1__.isBoom(err)) {\n      console.log(err);\n      res.status(err.output.payload.statusCode);\n      res.json({\n        error: err.output.payload.error,\n        message: err.output.payload.message\n      });\n    } else {\n      res.status(500);\n      res.json({\n        message: \"Unexpected error\"\n      });\n      console.error(err); // unexcepted error\n    }\n  }\n\n});\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (apiHandler);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi91dGlscy5zZXJ2ZXIudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOztBQUlBLE1BQU1FLFVBQVUsR0FBRyxNQUNqQkYsbURBQUUsQ0FBa0M7QUFDbENHLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLEdBQVgsRUFBZ0I7QUFDckIsUUFBSUwsOENBQUEsQ0FBWUcsR0FBWixDQUFKLEVBQXNCO0FBQ3BCSSxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUwsR0FBWjtBQUNBRSxNQUFBQSxHQUFHLENBQUNJLE1BQUosQ0FBV04sR0FBRyxDQUFDTyxNQUFKLENBQVdDLE9BQVgsQ0FBbUJDLFVBQTlCO0FBQ0FQLE1BQUFBLEdBQUcsQ0FBQ1EsSUFBSixDQUFTO0FBQ1BDLFFBQUFBLEtBQUssRUFBRVgsR0FBRyxDQUFDTyxNQUFKLENBQVdDLE9BQVgsQ0FBbUJHLEtBRG5CO0FBRVBDLFFBQUFBLE9BQU8sRUFBRVosR0FBRyxDQUFDTyxNQUFKLENBQVdDLE9BQVgsQ0FBbUJJO0FBRnJCLE9BQVQ7QUFJRCxLQVBELE1BT087QUFDTFYsTUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWDtBQUNBSixNQUFBQSxHQUFHLENBQUNRLElBQUosQ0FBUztBQUNQRSxRQUFBQSxPQUFPLEVBQUU7QUFERixPQUFUO0FBR0FSLE1BQUFBLE9BQU8sQ0FBQ08sS0FBUixDQUFjWCxHQUFkLEVBTEssQ0FNTDtBQUNEO0FBQ0Y7O0FBakJpQyxDQUFsQyxDQURKOztBQXFCQSxpRUFBZUYsVUFBZiIsInNvdXJjZXMiOlsid2VicGFjazovL215LW5leHQvLi91dGlscy5zZXJ2ZXIudHM/ZTAzZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbmMgZnJvbSBcIm5leHQtY29ubmVjdFwiO1xuaW1wb3J0ICogYXMgQm9vbSBmcm9tIFwiQGhhcGkvYm9vbVwiO1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgYm9keVBhcnNlciBmcm9tICdib2R5LXBhcnNlcic7XG5cbmNvbnN0IGFwaUhhbmRsZXIgPSAoKSA9PlxuICBuYzxOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlPih7XG4gICAgb25FcnJvcihlcnIsIHJlcSwgcmVzKSB7XG4gICAgICBpZiAoQm9vbS5pc0Jvb20oZXJyKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICByZXMuc3RhdHVzKGVyci5vdXRwdXQucGF5bG9hZC5zdGF0dXNDb2RlKTtcbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIGVycm9yOiBlcnIub3V0cHV0LnBheWxvYWQuZXJyb3IsXG4gICAgICAgICAgbWVzc2FnZTogZXJyLm91dHB1dC5wYXlsb2FkLm1lc3NhZ2UsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApO1xuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogXCJVbmV4cGVjdGVkIGVycm9yXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIC8vIHVuZXhjZXB0ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxuZXhwb3J0IGRlZmF1bHQgYXBpSGFuZGxlciJdLCJuYW1lcyI6WyJuYyIsIkJvb20iLCJhcGlIYW5kbGVyIiwib25FcnJvciIsImVyciIsInJlcSIsInJlcyIsImlzQm9vbSIsImNvbnNvbGUiLCJsb2ciLCJzdGF0dXMiLCJvdXRwdXQiLCJwYXlsb2FkIiwic3RhdHVzQ29kZSIsImpzb24iLCJlcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./utils.server.ts\n");

/***/ }),

/***/ "./utils/getProfitLists.ts":
/*!*********************************!*\
  !*** ./utils/getProfitLists.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/prisma */ \"./lib/prisma.js\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\nasync function getProfitData(req) {\n  const {\n    cid,\n    mid,\n    startDate,\n    endDate\n  } = req;\n\n  const where = _objectSpread(_objectSpread(_objectSpread({}, cid ? {\n    cid\n  } : {}), mid ? {\n    mid\n  } : {}), {}, {\n    date_str: {\n      gte: startDate,\n      lt: endDate\n    }\n  });\n\n  return await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.default.local_sku_mid_profit_lists.findMany({\n    where\n  });\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (getProfitData);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi91dGlscy9nZXRQcm9maXRMaXN0cy50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUdBLGVBQWVDLGFBQWYsQ0FBNkJDLEdBQTdCLEVBQWtEO0FBQ2hELFFBQU07QUFBRUMsSUFBQUEsR0FBRjtBQUFNQyxJQUFBQSxHQUFOO0FBQVVDLElBQUFBLFNBQVY7QUFBb0JDLElBQUFBO0FBQXBCLE1BQWdDSixHQUF0Qzs7QUFDQSxRQUFNSyxLQUFLLGlEQUNMSixHQUFHLEdBQUc7QUFBRUEsSUFBQUE7QUFBRixHQUFILEdBQWEsRUFEWCxHQUVMQyxHQUFHLEdBQUc7QUFBRUEsSUFBQUE7QUFBRixHQUFILEdBQWEsRUFGWDtBQUdUSSxJQUFBQSxRQUFRLEVBQUU7QUFDUkMsTUFBQUEsR0FBRyxFQUFFSixTQURHO0FBRVJLLE1BQUFBLEVBQUUsRUFBR0o7QUFGRztBQUhELElBQVg7O0FBU0EsU0FBTyxNQUFNTixvRkFBQSxDQUEyQztBQUN0RE8sSUFBQUE7QUFEc0QsR0FBM0MsQ0FBYjtBQUdEOztBQUdELGlFQUFlTixhQUFmIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktbmV4dC8uL3V0aWxzL2dldFByb2ZpdExpc3RzLnRzP2Y5YzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHByaXNtYSBmcm9tICcuLi9saWIvcHJpc21hJ1xuXG5cbmFzeW5jIGZ1bmN0aW9uIGdldFByb2ZpdERhdGEocmVxKTogUHJvbWlzZTxvYmplY3Q+e1xuICBjb25zdCB7IGNpZCxtaWQsc3RhcnREYXRlLGVuZERhdGUgfSA9IHJlcTtcbiAgY29uc3Qgd2hlcmUgPSB7XG4gICAgLi4uKGNpZCA/IHsgY2lkIH0gOiB7fSksXG4gICAgLi4uKG1pZCA/IHsgbWlkIH0gOiB7fSksXG4gICAgZGF0ZV9zdHI6IHtcbiAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgbHQ6ICBlbmREYXRlXG4gICAgfSxcbiAgfTtcblxuICByZXR1cm4gYXdhaXQgcHJpc21hLmxvY2FsX3NrdV9taWRfcHJvZml0X2xpc3RzLmZpbmRNYW55KHtcbiAgICB3aGVyZVxuICB9KVxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGdldFByb2ZpdERhdGEiXSwibmFtZXMiOlsicHJpc21hIiwiZ2V0UHJvZml0RGF0YSIsInJlcSIsImNpZCIsIm1pZCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ3aGVyZSIsImRhdGVfc3RyIiwiZ3RlIiwibHQiLCJsb2NhbF9za3VfbWlkX3Byb2ZpdF9saXN0cyIsImZpbmRNYW55Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./utils/getProfitLists.ts\n");

/***/ }),

/***/ "@hapi/boom":
/*!*****************************!*\
  !*** external "@hapi/boom" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("@hapi/boom");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "dayjs":
/*!************************!*\
  !*** external "dayjs" ***!
  \************************/
/***/ ((module) => {

module.exports = require("dayjs");

/***/ }),

/***/ "next-connect":
/*!*******************************!*\
  !*** external "next-connect" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("next-connect");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("./pages/api/statistic/getAllStatistic.ts"));
module.exports = __webpack_exports__;

})();